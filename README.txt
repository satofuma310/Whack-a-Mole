拡張メソッド、コールバックを使うことでコードを簡略化しました。